<div class="fixed inset-0 bg-surface-900/60 backdrop-blur-sm z-[100] flex items-start justify-center pt-[15vh]"
    (click)="close()">
    <div class="bg-white rounded-2xl shadow-premium-lg w-full max-w-xl animate-fade-in overflow-hidden"
        (click)="$event.stopPropagation()">

        <!-- Search Input -->
        <div class="p-4 border-b border-surface-100">
            <div class="relative">
                <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-surface-400" viewBox="0 0 24 24"
                    fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
                <input #searchInput type="text" [(ngModel)]="query" (ngModelChange)="onSearch($event)"
                    (keydown)="onKeydown($event)" placeholder="Buscar estudiantes, citas, secciones..."
                    class="w-full pl-12 pr-4 py-3 bg-surface-50 border-0 rounded-xl text-surface-700 placeholder-surface-400 focus:ring-2 focus:ring-primary-500 focus:bg-white transition-all" />
                <div class="absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-1">
                    <kbd class="px-2 py-1 bg-surface-100 text-surface-500 text-xs rounded font-medium">ESC</kbd>
                </div>
            </div>
        </div>

        <!-- Results -->
        <div class="max-h-[50vh] overflow-y-auto">
            @if (loading()) {
            <div class="p-8 text-center">
                <div class="w-6 h-6 border-2 border-primary-500 border-t-transparent rounded-full animate-spin mx-auto">
                </div>
            </div>
            } @else if (groups().length === 0 && query.length > 0) {
            <div class="p-8 text-center">
                <p class="text-surface-400">No se encontraron resultados para "{{ query }}"</p>
            </div>
            } @else {
            @for (group of groups(); track group.name) {
            <div class="p-2">
                <p class="px-3 py-2 text-xs font-semibold text-surface-400 uppercase tracking-wider">{{ group.name }}
                </p>
                @for (result of group.results; track result.title; let i = $index) {
                <button (click)="selectResult(result)" [class.bg-primary-50]="isSelected(group, i)"
                    class="w-full flex items-center gap-3 px-3 py-2.5 rounded-xl hover:bg-surface-50 transition-colors text-left group">
                    <span class="text-xl">{{ result.icon }}</span>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-surface-700 truncate">{{ result.title }}</p>
                        @if (result.subtitle) {
                        <p class="text-xs text-surface-400 truncate">{{ result.subtitle }}</p>
                        }
                    </div>
                    @if (result.type === 'navigation') {
                    <svg class="w-4 h-4 text-surface-300 group-hover:text-surface-500 transition-colors"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                    }
                </button>
                }
            </div>
            }
            }
        </div>

        <!-- Footer -->
        <div
            class="p-3 border-t border-surface-100 bg-surface-50 flex items-center justify-between text-xs text-surface-400">
            <div class="flex items-center gap-4">
                <span class="flex items-center gap-1">
                    <kbd class="px-1.5 py-0.5 bg-white rounded border border-surface-200">↑↓</kbd>
                    navegar
                </span>
                <span class="flex items-center gap-1">
                    <kbd class="px-1.5 py-0.5 bg-white rounded border border-surface-200">↵</kbd>
                    seleccionar
                </span>
            </div>
            <span class="flex items-center gap-1">
                <kbd class="px-1.5 py-0.5 bg-white rounded border border-surface-200">⌘K</kbd>
                abrir búsqueda
            </span>
        </div>
    </div>
</div>